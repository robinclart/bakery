#!/usr/bin/env ruby
$:.unshift File.expand_path("../../lib", __FILE__)

require 'bakery'
require 'bakery/generators'

# Invoke the compile command if there is no arguments or if the first argument
# match --force or match -f or match an existing file.
if ARGV.empty? or ARGV.first.match(/^-f|--force$/) or File.exist?(ARGV.first)
  ARGV.unshift "compile"
end

if !!ARGV.first.match(/^-v|--version$/)
  puts "bakery v#{Bakery::VERSION}"
  exit
end

if !!ARGV.first.match(/^-h|--help|help$/) and ARGV[1].nil?
  puts "help"
  exit
end

begin
  command = !!ARGV.first.match(/^-h|--help|help$/) ? ARGV[1] : ARGV[0]
  generator = Bakery::Generators.const_get(command.camelize)
rescue NameError
  puts "invalid command"
  exit
end

if ARGV.first.eql?("help")
  generator.help Thor::Base.shell.new
elsif File.exist?('Bakefile') || ARGV.first.eql?("init")
  ARGV.shift
  generator.start
else
  puts "This is not a bakery. Please run 'bake init' first."
end

exit # bye
