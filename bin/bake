#!/usr/bin/env ruby
$:.unshift File.expand_path("../../lib", __FILE__)

require 'bakery'
require 'bakery/generators'

# Invoke the compile command if there is no arguments or if the first argument
# match --force or match -f or match an existing file.
if ARGV.empty? or ARGV.first.match(/^-f|--force$/) or File.exist?(ARGV.first)
  ARGV.unshift "compile"
end

begin
  command = ARGV.first.eql?("help") ? ARGV.shift : ARGV.first
  generator = Bakery::Generators.const_get(ARGV.shift.camelize)

  Bakery.load_config! unless command == "init"

  if command == "help"
    generator.help Thor::Base.shell.new
  else
    generator.start
  end
rescue NameError
  puts "invalid command"
rescue LoadError
  puts "This is not a bakery. Please run 'bake init' first."
end

exit # bye
